"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4071],{46118:function(e,t,a){a.d(t,{V:function(){return l}});var n=a(52322),r=a(21051),s=a(2784);function l(e){let{text:t,animate:a,chunkSize:l=2,className:i,useMarkdown:o,onAnimationEnd:c,onAnimationUpdate:d,animationSpeed:u=33,textColorOverride:m}=e,x=(0,s.useRef)(a?"":null!=t?t:""),h=(0,s.useRef)(null),[,f]=(0,s.useState)(0),p=(0,s.useRef)(0),g=(0,s.useRef)();return((0,s.useEffect)(()=>(clearInterval(g.current),g.current=setInterval(()=>{if(t&&x.current.length<t.length){let e=t.slice(x.current.length,x.current.length+l);x.current+=e,p.current+=1,f(p.current),null==d||d()}t&&x.current.length>=t.length&&(clearInterval(g.current),f(p.current),null==c||c())},u),()=>{clearInterval(g.current)}),[u,l,t,c,d]),o)?(0,n.jsx)(r.U,{"sentry-block":!0,textStyle:{...m&&{color:m}},children:x.current}):(0,n.jsx)("p",{ref:h,className:i,style:{...m&&{color:m}},children:x.current})}},21051:function(e,t,a){a.d(t,{U:function(){return N}});var n=a(52322),r=a(2784),s=a(18818),l=a(69172),i=a(90122),o=a(23279),c=a(60614);let d=e=>{let t=null;return async()=>null!=t?t:t=await e()},u=e=>{let[t,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{e().then(e=>{a(e)})},[e]),t};var m=a(17063),x=a(27617),h=a(98614);let f=(0,r.lazy)(()=>Promise.all([a.e(7715),a.e(8394),a.e(5941),a.e(8365),a.e(1446)]).then(a.bind(a,91446))),p=(0,r.lazy)(()=>a.e(1109).then(a.bind(a,91109))),g=d(()=>Promise.all([a.e(7715),a.e(5941),a.e(119)]).then(a.bind(a,90119))),v=d(()=>Promise.all([a.e(4620),a.e(7715),a.e(8394),a.e(4241)]).then(a.bind(a,74241))),j=d(()=>a.e(4597).then(a.bind(a,44597))),y=/language-(\w+)/;function b(e){let{children:t,forceSmallText:a,textStyle:r}=e,{t:d}=(0,h.$G)(),m=(0,s.Dv)(),b=(0,s.Ui)(),{isDenseChatStyle:N}=(0,c.ax)(),_=u(g),w=u(v),S=u(j),C=_&&S?[_.default,S.default]:[],P=w?[w.default]:[],k=!!a||N||m,O={...k&&{fontSize:14},...r};return(0,n.jsx)(f,{remarkPlugins:C,rehypePlugins:P,components:{h1:e=>{let{children:t,...a}=e;return(0,n.jsx)("h1",{...a,style:O,children:t})},h2:e=>{let{children:t,...a}=e;return(0,n.jsx)("h2",{...a,style:O,children:t})},h3:e=>{let{children:t,...a}=e;return(0,n.jsx)("h3",{...a,style:O,children:t})},p:e=>{let{children:t,...a}=e;return(0,n.jsx)("p",{...a,style:{fontFamily:"var(--inter-font)",whiteSpace:"pre-wrap",lineHeight:1.5,wordBreak:"break-word",...O},children:t})},ul:e=>{let{children:t,...a}=e;return(0,n.jsx)("ul",{style:{lineHeight:"18px",paddingLeft:"16px",fontSize:k?14:16},...a,children:t})},ol:e=>{let{children:t,...a}=e;return(0,n.jsx)("ol",{style:{lineHeight:"18px",paddingLeft:"16px",fontSize:k?14:16},...a,children:t})},pre:e=>{let t=e.children;if("code"===t.props.node.tagName){let e=y.exec(t.props.className||""),{children:a}=t.props;return a?(0,n.jsxs)("div",{className:"py-3 overflow-hidden grid",children:[(0,n.jsxs)("div",{className:"bg-surface-elevation-2 px-2 font-mono justify-between flex flex-row-reverse text-md items-center",children:[(0,n.jsxs)(o.zx,{variant:"ghost",className:"h-min py-1 self-end",onPress:()=>{x.Wj.copyTextToClipboard(a,d("Common.code-copied-to-clipboard"),"chat_markdown")},children:[d("Common.copy")," ",(0,n.jsx)(i.TI,{height:"1.25em"})]}),(null==e?void 0:e[1])||""]}),(0,n.jsx)(p,{style:l.Z,customStyle:{margin:0,overflowX:"scroll",fontSize:m?10:12,background:"var(--G950)"},codeTagProps:{className:"text-sm bg-surface-base m-0 overflow-x-scroll max-w-4xl min-max-w-4xl"},showLineNumbers:!!N&&b,language:(null==e?void 0:e[1])||"javascript",children:a.trimEnd()})]}):null}return(0,n.jsx)("pre",{children:e.children})},code:e=>(0,n.jsx)("code",{className:"bg-surface-elevation-2 p-1 font-light",children:e.children})},children:t})}function N(e){let{children:t,forceSmallText:a,textStyle:r,fullWidth:s}=e;return(0,n.jsx)("div",{className:(0,m.cn)("prose dark:prose-invert",s?"max-w-full":"max-w-3xl"),children:(0,n.jsx)(b,{forceSmallText:a,textStyle:r,children:t})})}},67940:function(e,t,a){a.d(t,{S:function(){return o}});var n=a(52322),r=a(2784),s=a(83973),l=a(17063),i=a(90834);function o(e){let{numDots:t=3,animating:a=!0,defaultValue:o=0,className:c}=e,[d,u]=(0,r.useState)(Array(t).fill(o));return(0,r.useEffect)(()=>{if(a){let{stop:e,push:a}=function(e,t){let a=function(e,t,a){let n=Array(e),r=8/e,s=e=>(1/(t*Math.sqrt(2*Math.PI)))**Math.E**(-.5*((e-0)/t)**2),l=-r*Math.floor(e/2);for(let t=0;t<e;t++){let e=s(l);n[t]=e,l+=r}return n}(e,.2,0),n=[],r=!1,s=()=>{if(!r){if(0===n.length)t(a.map(e=>e*(5+2*Math.random())));else{let e=n.pop();null!=e&&t(a.map((t,a)=>5+10*e[a]*t))}setTimeout(s,125)}},l=0;return s(),{push:e=>{n.length<5?n.push(e):n[5%l]=e,l++},stop:()=>{r=!0}}}(t,u),n=Array(t),r=(0,s.s)(i.vx.OneWayVoice,e=>{let r=Math.floor(e.length/t);for(let a=0;a<t;a++){let t=0;for(let n=r*a,s=n;s<n+r;s++)t+=Math.min(1,5*Math.abs(e[s]));n[a]=t/r}a(n)});return()=>{r(),e()}}},[a,t]),(0,n.jsx)("div",{className:"flex flex-row gap-px items-center h-3",children:d.map((e,t)=>(0,n.jsx)("div",{style:{height:"".concat(e,"px")},className:(0,l.cn)("bg-voice-blue rounded-md w-[2px] h-2 transition-[height]",c)},t))})}a(52370)},87394:function(e,t,a){a.d(t,{X4:function(){return g},qt:function(){return v}});var n=a(52322),r=a(44460),s=a(71126),l=a(36562),i=a(10661),o=a(25706),c=a(62780),d=a(47969),u=a(27617),m=a(1086),x=a(2784),h=a(15584);let f={getCandidatePlaybackStatus:()=>d.PO.NotPlaying,playVoiceMemo:u.ws,stopVoiceMemo:u.ws},p=(0,x.createContext)(f),g=e=>{let{children:t}=e,a=(0,h.BF)(o.Mc),u=(0,h.BF)(o.AK),{isCharacterSpeaking:f}=(0,l.AW)(),{replayUrl:g,error:v}=(0,m.QR)(null!=a?a:void 0),j=(0,i.tz)(),y=(0,x.useCallback)((e,t)=>{e!==o.AK.value&&(r.iN.mediaPlaybackStatusChanged({type:"voice_memo",referrer:"VoiceMemoContext",playback_status:null!=t?t:e,previous_playback_status:o.AK.value,voice_id:null==a?void 0:a.voiceId}),o.AK.value=e,e===d.PO.NotPlaying&&(o.Mc.value=null))},[null==a?void 0:a.voiceId]);(0,x.useEffect)(()=>{if(g)try{(0,c.Sk)(g,"one-off",{onEnded:()=>{y(d.PO.NotPlaying,"completed")},onPlay:()=>{y(d.PO.Playing,"playing")}})}catch(e){y(d.PO.NotPlaying,"error"),(0,s.H)("Failed to play voice memo",{error:e,type:s.NI.Voice,extra:{replayUrl:g}})}},[g,y]),(0,x.useEffect)(()=>{v&&((0,s.H)("Failed to fetch voice memo url",{error:v,type:s.NI.Voice}),j(),y(d.PO.NotPlaying,"error"))},[v,j,y]);let b=(0,x.useCallback)(e=>(null==a?void 0:a.candidateId)===e?u:d.PO.NotPlaying,[u,null==a?void 0:a.candidateId]),N=(0,x.useCallback)(async e=>{let{chatId:t,turnId:a,candidateId:n,voiceId:r,voiceQuery:l}=e,i=!r&&!l;if(!t||!a||!n||i){(0,s.H)("Missing required fields to play voice memo",{type:s.NI.Voice,extra:{chatId:t,turnId:a,candidateId:n,voiceId:r}}),j();return}o.Mc.value=e,y(d.PO.Loading)},[j,y]),_=(0,x.useCallback)(()=>{(0,c.ON)("one-off"),y(d.PO.NotPlaying,"stopped")},[y]);(0,x.useEffect)(()=>{f&&_()},[f,_]);let w=(0,x.useMemo)(()=>({getCandidatePlaybackStatus:b,playVoiceMemo:N,stopVoiceMemo:_}),[b,N,_]);return(0,n.jsx)(p.Provider,{value:w,children:t})},v=()=>(0,x.useContext)(p)},88447:function(e,t,a){a.d(t,{X:function(){return n}});function n(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},47605:function(e,t,a){a.d(t,{f:function(){return es}});var n=a(52322),r=a(38837),s=a(11403),l=a(60614),i=a(18818),o=a(99732),c=a(25706),d=a(17063),u=a(15584),m=a(56462);let x=e=>{if(!(null==e?void 0:e.is_final)||!e.debug_info)return{};let t={};try{t=JSON.parse(e.debug_info)}catch(e){}return t};var h=a(25237),f=a.n(h),p=a(2784),g=a(44460),v=a(27617);let j=f()(()=>a.e(8047).then(a.t.bind(a,48047,23)),{loadableGenerated:{webpack:()=>[48047]},ssr:!1});function y(e){return(0,u.BF)(c.AR)?(0,n.jsx)(N,{...e}):null}function b(e){let{label:t,field:a,slice:r}=e;return(0,n.jsxs)("p",{title:a,className:"cursor-copy hover:text-ring p-1 font-mono text-sm",onClick:()=>{g.iN.messageCopied({referrer:"CandidateDebugInfo"}),v.Wj.copyTextToClipboard(a)},children:[t,": ",r?a.slice(0,r):a]})}function N(e){let{candidate:t,turn:a}=e,[r,s]=(0,p.useState)(""),l=(0,p.useMemo)(()=>x(t),[t]),i=Object.keys(l).length,o=function e(t,a){let n;if(Object.keys(a).forEach(e=>{e.includes(t)&&void 0===n&&(n={[e]:a[e]})}),void 0!==n)return n;for(let r in a)if(a[r]&&"object"==typeof a[r]&&void 0!==(n=e(t,a[r])))return{[t]:n};return n}(r,l);return o&&r&&(l=o),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"rounded-spacing-xxs overflow-hidden bg-black [&>*:nth-child(odd)]:bg-surface-elevation-1 [&>*:nth-child(even)]:bg-surface-elevation-3",children:[(0,n.jsx)(b,{label:"create_time",field:t.create_time}),(0,n.jsx)(b,{label:"turn_id",field:a.turn_key.turn_id,slice:8}),(0,n.jsx)(b,{label:"primary_candidate_id",field:a.primary_candidate_id,slice:8}),(0,n.jsx)(b,{label:"candidate_id",field:t.candidate_id,slice:8}),!!a.isLastAiMessage&&(0,n.jsx)(b,{label:"isLastAiMessage",field:a.isLastAiMessage?"true":"false",slice:8}),!!a.isLastUserMessage&&(0,n.jsx)(b,{label:"isLastUserMessage",field:a.isLastUserMessage?"true":"false",slice:8}),!!a.isGreetingMessage&&(0,n.jsx)(b,{label:"greeting_mesage",field:a.isGreetingMessage?"true":"false",slice:8}),!!t.base_candidate_id&&(0,n.jsx)(b,{label:"base_candidate_id",field:t.base_candidate_id,slice:8})]}),i>0&&(0,n.jsxs)("div",{className:"flex flex-col gap-2 p-2",children:[(0,n.jsx)(m.I,{value:r,onChange:e=>s(e.target.value),placeholder:"debug filter key"}),(0,n.jsx)(j,{theme:"ocean",name:null,src:l,displayDataTypes:!1,shouldCollapse:()=>!0,collapseStringsAfterLength:50,iconStyle:"circle"})]})]})}var _=a(90122);function w(){return(0,n.jsx)("div",{className:"ticontainer",children:(0,n.jsxs)("div",{className:"tiblock",children:[(0,n.jsx)("div",{className:"tidot"}),(0,n.jsx)("div",{className:"tidot"}),(0,n.jsx)("div",{className:"tidot"})]})})}var S=a(48461),C=a(66582),P=a(98614),k=a(63554),O=a(48683),I=a(46118),M=a(21051),z=a(566),A=a(69937);let E=(0,p.memo)(e=>{var t;let{text:a,candidate:r,animate:s,onAnimationUpdate:l,onAnimationEnd:i,supportsThrottledAnimation:o,textColorOverride:c}=e,d=null===(t=(0,O.i)(k.b.EnforceMessageQuota))||void 0===t?void 0:t.payload,{user:u}=(0,z.a)(),{chunkSize:m,animationSpeed:x,setIsActivelyAnimating:h}=(0,A.pD)({quotaOptions:d,user:u,supportsThrottledAnimation:o}),f=(0,p.useCallback)(()=>{h(o),null==l||l()},[l,h,o]),g=(0,p.useCallback)(()=>{h(!1),null==i||i()},[i,h]);return((0,p.useEffect)(()=>()=>{h(!1)},[h]),s)?(0,n.jsx)(I.V,{text:a,animate:!r.is_final,useMarkdown:!0,chunkSize:m,animationSpeed:x,onAnimationUpdate:f,onAnimationEnd:g,textColorOverride:c},r.candidate_id):(0,n.jsx)(M.U,{"sentry-block":!0,textStyle:{...c&&{color:c}},children:null!=a?a:""})},(e,t)=>e.text===t.text&&e.candidate===t.candidate&&e.animate===t.animate&&e.onAnimationUpdate===t.onAnimationUpdate&&e.onAnimationEnd===t.onAnimationEnd&&e.supportsThrottledAnimation===t.supportsThrottledAnimation&&e.textColorOverride===t.textColorOverride);E.displayName="ChatCandidateText";var T=a(74943),U=a(57352),H=a(96577),F=a.n(H),D=a(91914),G=a(65186);function L(e){let{src:t,retryCount:a=10,style:r,className:s}=e,{t:l}=(0,P.$G)(),[i,o]=(0,p.useState)(!1),[c,d]=(0,p.useState)(0),[u,m]=(0,p.useState)(!1);return((0,p.useEffect)(()=>{let e=new Image;return e.src=t,e.onload=()=>o(!0),e.onerror=()=>{c<a?setTimeout(()=>d(c+1),1e3+250*c):m(!0)},()=>{e.onload=null,e.onerror=null}},[c,t,a]),(0,p.useEffect)(()=>{d(0),m(!1),o(!1)},[t]),u)?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-md text-center align-middle ".concat(s),style:{width:200,height:200,...r},children:[(0,n.jsx)(G._HA,{size:64,className:"fill-error"}),(0,n.jsx)("p",{className:"p-4 text-sm",children:l("Chat.Image.something-went-wrong-making-this-image")})]}):i?(0,n.jsx)(T.a2,{children:(0,n.jsx)(F(),{style:{...r},src:t,alt:"Loaded content",className:"rounded-md ".concat(s),width:200,height:200})}):(0,n.jsx)(T.a2,{children:(0,n.jsxs)("div",{style:{width:200,height:200,...r},className:"flex flex-col items-center justify-center rounded-md bg-accent text-center align-middle ".concat(s),children:[(0,n.jsx)(U.E.div,{style:{transformOrigin:"50% 57%"},animate:{rotate:[0,360]},transition:{duration:1,ease:"easeInOut",repeat:1/0},children:(0,n.jsx)(D.I0U,{size:32})}),(0,n.jsx)("p",{className:"p-4 text-sm",children:l("Chat.Image.creating-image")})]})})}var $=a(23279),V=a(77245);function X(){let{t:e}=(0,P.$G)(),[t,a]=(0,p.useState)(!1);return(0,n.jsxs)("div",{className:"bg-opacity/30 mt-4 flex flex-col items-center gap-5 rounded-md border-2 border-error p-4 text-center",children:[(0,n.jsx)(V.fxy,{size:48}),e("Chat.Filter.sometimes-the-ai-generates-a-reply-that-doesnt-meet-our-guidelines"),(0,n.jsx)("p",{className:"text-sm",children:e("Chat.Filter.you-can-continue-the-conversation-or-generate-a-new-response-by-swiping")}),(0,n.jsx)("div",{children:(0,n.jsx)($.zx,{isDisabled:t,variant:t?"ghost":"primary",color:t?"primary":"secondary",onPress:()=>{g.iN.messageFilteredAction({referrer:"FilteredMessage",type:"report"}),a(!0)},children:e(t?"Chat.Filter.reported":"Chat.report")})})]})}function R(e){let t,{turn:a,candidate:r,animate:s,onAnimationUpdate:i,onAnimationEnd:o,supportsThrottledAnimation:c}=e,{t:u}=(0,P.$G)(),m=a.is_pinned,x=r.base_candidate_id,{isDefaultChatStyle:h}=(0,l.ax)(),{userTextColorOverride:f,characterTextColorOverride:p}=(0,l.vX)();return(h&&(t=a.author.is_human?f:p),(0,S.Gd)(a,r))?(0,n.jsx)("div",{className:"px-4 mt-1",children:(0,n.jsx)(w,{})}):(0,n.jsxs)("div",{className:(0,d.cn)("font-display font-light",{"swiper-no-swiping":!C.tq}),children:[(0,n.jsx)(E,{text:r.raw_content,candidate:r,animate:s,onAnimationUpdate:i,onAnimationEnd:o,supportsThrottledAnimation:c,textColorOverride:h?t:void 0},r.candidate_id),!!r.tti_image_rel_path&&(0,n.jsx)(L,{src:r.tti_image_rel_path,retryCount:10,className:"m-2"}),(0,n.jsxs)("div",{className:"flex flex-row gap-1 items-center",children:[!!m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_.sh,{height:"0.75em",style:{rotate:"-30deg"},color:"var(--blue)"}),(0,n.jsx)("p",{className:"text-sm text-blue",children:u("Chat.pinned")})]}),!!m&&!!x&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"•"}),!!x&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",title:u("Chat.tooltip-message-edited-by-user"),children:u("Chat.edited")})]}),!!r.safety_truncated&&(0,n.jsx)(X,{}),(0,n.jsx)(y,{candidate:r,turn:a})]})}var W=a(76492),B=a(47969),K=a(67940),q=a(36562),Z=a(87394);let Q=(e,t,a)=>{let{voiceId:n,abortCharacterSpeech:r,hasVoice:s,voiceQuery:l}=(0,q.AW)(),{getCandidatePlaybackStatus:i,playVoiceMemo:o,stopVoiceMemo:d}=(0,Z.qt)(),m=(0,u.BF)(c.LT),x=(0,u.BF)(c.AK);return{canPlayMemo:!m,thisMemoPlaybackStatus:i(a),play:(0,p.useCallback)(()=>{if(!s){c.UK.value=!0;return}x===B.PO.Playing?(d(),setTimeout(()=>o({chatId:e,turnId:t,candidateId:a,voiceId:n,voiceQuery:l}),250)):o({chatId:e,turnId:t,candidateId:a,voiceId:n,voiceQuery:l})},[a,e,x,s,o,d,t,n,l]),stopVoiceMemo:d,abortCharacterSpeech:r,isCharacterSpeaking:m}};function J(e){let{play:t}=e,{t:a}=(0,P.$G)();return(0,n.jsx)($.zx,{"aria-label":a("Chat.play-voice"),variant:"ghost",isIconOnly:!0,disableAnimation:!0,disableRipple:!0,onPress:t,className:"size-4 p-0 hover:bg-transparent hover:brightness-125",children:(0,n.jsx)(_.o1,{className:"size-4 text-voice-blue"})})}function Y(e){let{stopVoiceMemo:t}=e,{t:a}=(0,P.$G)();return(0,n.jsx)($.zx,{"aria-label":a("Chat.stop-voice"),variant:"ghost",isIconOnly:!0,disableAnimation:!0,disableRipple:!0,onPress:t,className:"size-4 p-0 hover:bg-transparent hover:brightness-125",children:(0,n.jsx)(K.S,{numDots:5})})}function ee(e){let{abortCharacterSpeech:t}=e,{t:a}=(0,P.$G)();return(0,n.jsx)($.zx,{"aria-label":a("Chat.abort-speech"),variant:"ghost",isIconOnly:!0,disableAnimation:!0,disableRipple:!0,onPress:t,className:"size-4 p-0 hover:bg-transparent hover:brightness-125",children:(0,n.jsx)(K.S,{numDots:5})})}function et(e){let{chatId:t,turnId:a,candidateId:r,messageFinalized:s,showWaveform:l}=e,{canPlayMemo:i,thisMemoPlaybackStatus:o,play:c,stopVoiceMemo:u,abortCharacterSpeech:m,isCharacterSpeaking:x}=Q(t,a,r);(0,p.useEffect)(()=>()=>{o===B.PO.Playing&&u()},[o,u]);let h=!!x&&!i&&!!l;return(0,n.jsxs)("div",{className:"flex justify-center items-center h-3 ml-1",children:[!!(i&&s)&&(0,n.jsxs)("div",{className:(0,d.cn)("opacity-0 transition-all group-hover:opacity-100",{"opacity-100":o===B.PO.Playing||l}),children:[o===B.PO.NotPlaying&&(0,n.jsx)(J,{play:c}),o===B.PO.Loading&&(0,n.jsx)("div",{className:"size-10 flex justify-center items-center",children:(0,n.jsx)(W.$,{size:12})}),o===B.PO.Playing&&(0,n.jsx)(Y,{stopVoiceMemo:u})]}),!!h&&(0,n.jsx)(ee,{abortCharacterSpeech:m})]})}var ea=a(2236);function en(e){let{author:t,candidate:a,showTimeCreated:r,turn:s,showWaveform:l}=e,{isRoom:i}=(0,ea.m)();return(0,n.jsxs)("div",{className:"mx-2 flex flex-row items-center gap-2 font-light",children:[(0,n.jsx)("div",{className:"text-sm",children:t.name}),!t.is_human&&(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"rounded-2xl text-sm bg-secondary px-2 font-light h-fit",children:"c.ai"}),!i&&(0,n.jsx)(et,{showWaveform:l,chatId:s.turn_key.chat_id,turnId:s.turn_key.turn_id,candidateId:a.candidate_id,messageFinalized:!!a.is_final})]}),!!r&&!!a.create_time&&(0,n.jsx)("div",{className:"text-sm text-muted-foreground",title:new Date(a.create_time).toLocaleString(),children:(0,v.p6)(a.create_time)})]})}var er=a(65144);function es(e){let t,{turn:a,candidate:m,includeWaveForm:x,animate:h,className:f,onAnimationUpdate:p,onAnimationEnd:g,supportsThrottledAnimation:v}=e,j=(0,i.Dv)(),{isDefaultChatStyle:y,isDenseChatStyle:b,leftAlign:N,isChatClassicStyle:_}=(0,l.ax)(),{userChatColorOverride:w,characterChatColorOverride:S}=(0,l.vX)(),C=(0,o.M)(),P=(0,u.BF)(c.TU),k=a.author.is_human&&!N,O="";return y&&(a.author.is_human?(O=C?"bg-surface-elevation-3 opacity-90":"bg-surface-elevation-3",t=w):(O=C?"bg-surface-elevation-2 opacity-85":"bg-surface-elevation-2",t=S)),(0,n.jsxs)("div",{className:(0,d.cn)("m-0 flex flex-row items-start gap-2 justify-start",k?"mr-0 md:mr-6 flex-row-reverse":"ml-0 md:ml-6",f),children:[(0,n.jsx)("div",{className:"mt-0 hidden md:flex flex-col gap-3 items-center",children:a.author.is_human?(0,n.jsx)(s.a,{name:a.author.name,size:24,src:a.author.avatar_url}):(0,n.jsx)(r.B7,{name:a.author.name,size:24,src:a.author.avatar_url})}),(0,n.jsxs)("div",{className:(0,d.cn)("flex flex-col gap-1",k?"items-end sm:-mr-2":"items-start sm:-ml-2",{"w-full":c.TU}),children:[(0,n.jsx)(en,{author:a.author,candidate:m,showTimeCreated:!y,turn:a,showWaveform:x}),P===a.turn_key.turn_id?(0,n.jsx)(er.u,{candidate:m,turn:a}):(0,n.jsx)("div",{style:{minWidth:j?void 0:60,...t&&{background:t}},className:(0,d.cn)("mt-1 max-w-xl rounded-2xl px-3 min-h-12 flex justify-center ",{"py-3":y,"pb-4":_,"max-w-4xl":b},O),children:(0,n.jsx)(R,{candidate:m,turn:a,animate:h,onAnimationUpdate:p,onAnimationEnd:g,supportsThrottledAnimation:v},m.candidate_id)})]})]})}},65144:function(e,t,a){a.d(t,{K:function(){return h},u:function(){return f}});var n=a(52322),r=a(44460),s=a(90122),l=a(23279),i=a(7649),o=a(25706),c=a(2236),d=a(2784),u=a(98614),m=a(91262);function x(e){let{text:t,onSave:a,onCancel:r}=e,{t:s}=(0,u.$G)(),[i,o]=(0,d.useState)(t);return(0,n.jsxs)("div",{className:"w-full gap-2 flex flex-col max-w-xl",children:[(0,n.jsx)(m.g,{inputMode:"text",maxLength:4092,className:"box-border w-full rounded-none placeholder:text-placeholder min-w-xl bg-transparent text-lg-chat",value:i,onChange:e=>{o(e.target.value)}}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(l.zx,{variant:"ghost",onPress:r,children:s("Common.cancel")}),(0,n.jsx)(l.zx,{isDisabled:!i,onPress:()=>a(i),children:s("Form.save")})]})]})}function h(e){let{turn_id:t}=e,{t:a}=(0,u.$G)();return(0,n.jsxs)(l.zx,{variant:"ghost",className:"justify-between w-full rounded-spacing-s hover:bg-surface-elevation-2",onPress:()=>{o.TU.value=t,r.iN.messageEdited({action:"editing",referrer:"EditCandidateComponent"})},children:[a("Chat.edit-message")," ",(0,n.jsx)(s.dY,{height:"1.25em"})]})}function f(e){let{candidate:t,turn:a}=e,{characterId:s}=(0,i.AU)(),{publish:l}=(0,c.m)(),u=(0,d.useCallback)(e=>{e&&(l(s,{type:"edit_turn_candidate",turnKey:a.turn_key,candidateId:t.candidate_id,newRawContent:e}),o.TU.value=null,r.iN.messageEdited({action:"saved",referrer:"EditCandidateComponent"}))},[t.candidate_id,s,l,a.turn_key]);return(0,n.jsx)(x,{onCancel:()=>{o.TU.value=null,r.iN.messageEdited({action:"cancelled",referrer:"EditCandidateComponent"})},onSave:u,text:t.raw_content||""})}},39377:function(e,t,a){a.d(t,{i:function(){return S},N:function(){return C}});var n=a(52322),r=a(38837),s=a(83895),l=a(74943),i=a(68741),o=a(76727),c=a(94766),d=a(566),u=a(17063),m=a(27617),x=a(44460),h=a(23279),f=a(90122),p=a(47843),g=a(98614),v=a(18978);function j(e){let{isOpen:t,setIsOpen:a}=e,{t:r}=(0,g.$G)();return t?(0,n.jsx)(p.Vq,{open:!0,onOpenChange:e=>a(e),analyticsProps:{referrer:"Chat",type:"SelfHarmDetectorDialog"},children:(0,n.jsxs)(p.cZ,{className:"w-full max-w-xl",children:[(0,n.jsx)(p.fK,{children:(0,n.jsxs)(p.$N,{children:[" ",r("SelfHarmSupport.title")]})}),(0,n.jsxs)(p.Be,{children:[(0,n.jsx)("p",{className:"text-muted-foreground",children:r("SelfHarmSupport.body-1")}),(0,n.jsxs)("section",{className:"my-5",children:[(0,n.jsx)("h2",{className:"text-md-medium text-accent-foreground mt-4 mb-1",children:r("SelfHarmSupport.heading-2")}),(0,n.jsx)("p",{className:"text-muted-foreground",children:r("SelfHarmSupport.body-2")}),(0,n.jsx)("a",{href:"tel:".concat("988"),children:(0,n.jsxs)(h.zx,{size:"sm",className:"text-sm my-2",children:[(0,n.jsx)(v.DNl,{})," ",r("SelfHarmSupport.call")]})})]}),(0,n.jsxs)("section",{className:"my-5",children:[(0,n.jsx)("h2",{className:"text-md-medium text-accent-foreground mt-4 mb-1",children:r("SelfHarmSupport.heading-3")}),(0,n.jsx)("p",{className:"text-muted-foreground",children:r("SelfHarmSupport.body-3")}),(0,n.jsx)("a",{href:"https://findahelpline.com/i/iasp",target:"_blank",rel:"noreferrer",children:(0,n.jsxs)(h.zx,{size:"sm",className:"text-sm my-2",children:[(0,n.jsx)(v.gjK,{}),r("SelfHarmSupport.visit")]})})]}),(0,n.jsx)("section",{className:"my-5",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:r("SelfHarmSupport.body-4")})})]})]})}):null}var y=a(41133),b=a(2784);let N=e=>{let{turnId:t,chatInstanceId:a}=e,{removeClientMessages:r}=(0,y.mx)(),{t:s}=(0,g.$G)(),[i,o]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{x.iN.contentViewed({content:"SelfHarmSupportMessage",referrer:"SelfHarmSupportMessage"})},[]),(0,n.jsx)(l.a2,{children:(0,n.jsxs)("div",{className:"flex items-center justify-center w-full m-auto",children:[(0,n.jsxs)("div",{className:"relative m-4 w-3/4 max-w-[500px] p-4 pt-5 border border-accent rounded-2xl space-y-1",children:[(0,n.jsx)(h.zx,{variant:"ghost",isIconOnly:!0,size:"sm",className:"absolute top-1 right-1 text-muted-foreground font-semibold",onPress:()=>{a&&r(a,[t])},children:(0,n.jsx)(f.Tw,{height:"1em"})}),(0,n.jsx)("h2",{className:"text-md font-medium",children:s("SelfHarmSupport.title")}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground font-light",children:s("SelfHarmSupport.body-1")}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(h.zx,{variant:"primary",color:"secondary",size:"sm",className:"w-1/2 m-auto mt-2",onClick:()=>{o(!0)},children:s("Common.view-more")})})]}),(0,n.jsx)(j,{isOpen:i,setIsOpen:o})]})})};var _=a(92262),w=a(54504);function S(e){var t,a,c,x,h;let{turn:f,chatInstanceId:p,className:v,characterPageUrl:j,hasCustomBackground:y}=e,{user:b}=(0,d.a)(),{t:S}=(0,g.$G)(),{character:C}=(0,_.XS)(f.author.author_id),P=j||m.nN.characterProfile(null!==(c=null==C?void 0:C.short_hash)&&void 0!==c?c:f.author.author_id),k=null!==(x=null===(t=f.clientSystemMessage)||void 0===t?void 0:t.payload)&&void 0!==x?x:"";switch(null===(a=f.clientSystemMessage)||void 0===a?void 0:a.messageType){case w.lo.creator_attribution:return(0,n.jsx)(l.a2,{children:(0,n.jsxs)("div",{className:(0,u.cn)("flex flex-col items-center justify-center text-center gap-1 pb-6",b?"pt-12":"pt-8",v),children:[P?(0,n.jsx)(r.lc,{href:P,referrer:"ChatSystemMessage",characterId:f.author.author_id,name:f.author.name,size:64,src:f.author.avatar_url}):(0,n.jsx)(r.Ps,{name:f.author.name,size:64,src:f.author.avatar_url}),P?(0,n.jsx)(s.U,{name:f.author.name,className:"bold text-lg",href:P,referrer:"ChatSystemMessage",characterId:f.author.author_id}):(0,n.jsx)(s.E,{name:f.author.name,className:"bold text-lg"}),(0,n.jsx)("p",{className:(0,u.cn)("font-light text-md-medium",y?"text-foreground":"text-muted-foreground"),children:null===(h=f.clientSystemMessage)||void 0===h?void 0:h.message}),(0,n.jsx)(i.f,{author:k,clickable:!0,className:(0,u.cn)("text-medium font-light",y?"text-foreground":"text-muted-foreground")})]})});case w.lo.context_reset:return(0,n.jsxs)("div",{className:"flex items-center gap-4 my-4",children:[(0,n.jsx)(o.Z,{className:"flex-1"}),S("Chat.ai-conversation-reset")," ",(0,n.jsx)(o.Z,{className:"flex-1"})]});case w.lo.self_harm_detected:return(0,n.jsx)(N,{turnId:f.turn_key.turn_id,chatInstanceId:p});default:return null}}function C(){return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center text-center gap-1 pt-12 lg:pt-32",children:[(0,n.jsx)(c.O,{className:"h-16 w-16 rounded-lg"}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 mt-2 items-center",children:[(0,n.jsx)(c.O,{className:"w-20 h-5"}),(0,n.jsx)(c.O,{className:"w-64 h-6"}),(0,n.jsx)(c.O,{className:"w-32 h-4"})]})]})}},35396:function(e,t,a){a.d(t,{e:function(){return c}});var n=a(52322),r=a(27617),s=a(88447),l=a(97729),i=a.n(l),o=a(98614);let c=e=>{let{name:t,title:a,avatar_url:l,characterId:c,character_page_url:d,author:u}=e,{t:m}=(0,o.$G)(),x=(0,r.C3)(m("Pages.titles.characterChat",{name:t})),h=m("Pages.descriptions.characterChat",{name:t,title:a}),f={"@context":"https://schema.org","@type":"SoftwareApplication",name:(0,s.X)(t),description:(0,s.X)(h),applicationCategory:"ChatApplication",operatingSystem:"Web",image:l?r.Wj.getCDNImageSource(l):void 0,url:"https://character.ai/chat/".concat(c),character:{"@type":"Person",name:(0,s.X)(t),description:(0,s.X)(a),image:l?r.Wj.getCDNImageSource(l):void 0,url:d},author:u?{"@type":"Person",url:"https://character.ai/profile/".concat(u),alternateName:"@".concat((0,s.X)(u)),description:h||m("Pages.descriptions.profileDefault",{author:(0,s.X)(u)})}:void 0};return(0,n.jsxs)(i(),{children:[(0,n.jsx)("title",{children:x}),(0,n.jsx)("meta",{name:"apple-itunes-app",content:"app-id=invalid-id"},"apple-itunes-app"),(0,n.jsx)("meta",{name:"description",content:h},"description"),(0,n.jsx)("meta",{property:"og:type",content:"website"},"og:type"),(0,n.jsx)("meta",{property:"og:title",content:x},"og:title"),(0,n.jsx)("meta",{property:"og:description",content:h},"og:description"),!!l&&(0,n.jsx)("meta",{property:"og:image",content:r.Wj.getCDNImageSource(l)},"og:image"),(0,n.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(f)}})]})}},94071:function(e,t,a){a.d(t,{Y:function(){return _}});var n=a(52322),r=a(44460),s=a(48683),l=a(38837),i=a(42843),o=a(3988),c=a(43119),d=a(13163),u=a(47843),m=a(25706),x=a(27617),h=a(19206),f=a(39783),p=a(47605),g=a(39377),v=a(35396),j=a(92262),y=a(54504),b=a(2784),N=a(98614);function _(e){var t,a,_;let{characterId:w,characterPageUrl:S}=e;(0,s.Xu)("ChatSignedOut");let{t:C}=(0,N.$G)(),{character:P}=(0,j.XS)(null!=w?w:""),[k,O]=(0,b.useState)(!1),[I,M]=(0,b.useState)(!1),[z,A]=(0,b.useState)(!1),E=(0,b.useRef)(null),T=()=>{let e=E.current;e&&e.scrollIntoView()},U=(0,b.useCallback)(e=>{O(e),M(e)},[O,M]);return((0,b.useEffect)(()=>{k&&r.iN.modalOpened({referrer:"ChatSignedOut",type:"SignInDialog"})},[k]),(0,b.useEffect)(()=>{m.Ib.value=!1},[]),P)?(0,n.jsxs)(n.Fragment,{children:[!!P&&(0,n.jsx)(v.e,{avatar_url:null==P?void 0:P.avatar_file_name,name:null==P?void 0:P.participant__name,title:null==P?void 0:P.title,characterId:w,character_page_url:S,author:P.user__username}),(0,n.jsxs)("div",{className:"flex flex-col gap-6 w-full justify-between max-w-3xl items-center overflow-x-hidden h-full pt-20",children:[(0,n.jsxs)("div",{className:"px-2 flex flex-col flex-1 w-full gap-2 h-full overflow-y-auto",children:[(0,n.jsx)(g.i,{turn:(0,x.hQ)({author:{avatar_url:null==P?void 0:P.avatar_file_name,name:null!==(t=null==P?void 0:P.name)&&void 0!==t?t:"",is_human:!1,author_id:""},clientSystemMessage:{message:null!==(a=null==P?void 0:P.title)&&void 0!==a?a:"",messageType:y.lo.creator_attribution,payload:null==P?void 0:P.user__username}}),className:"w-full px-10",characterPageUrl:S}),(0,n.jsx)(p.f,{candidate:(0,x.Fy)({raw_content:null==P?void 0:P.greeting}),turn:(0,x.hQ)({author:{avatar_url:null==P?void 0:P.avatar_file_name,name:null!==(_=null==P?void 0:P.name)&&void 0!==_?_:"",is_human:!1,author_id:""}}),animate:!0,className:"pr-10",onAnimationUpdate:T,onAnimationEnd:()=>{A(!0),T()}}),(0,n.jsx)("div",{ref:E,className:"w-full h-[120px]"}),!!z&&(0,n.jsx)("div",{ref:E,className:"w-full h-[108px]"})]}),(0,n.jsx)("div",{className:"p-0 bottom-0 w-full max-w-3xl flex justify-center",children:(0,n.jsx)(f.F6,{onSend:e=>{m.Ib.value=!0,m.f8.value="signup",localStorage.setItem((0,h.mu)(null==P?void 0:P.external_id),JSON.stringify({value:e,time:new Date}))}})}),!!(k||I)&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 bg-scrim w-full h-full"}),(0,n.jsx)(u.Vq,{open:k,onOpenChange:U,modal:!1,children:(0,n.jsxs)(u.cZ,{className:"flex-auto flex bg-surface-elevation-1 flex-col justify-between items-center",children:[(0,n.jsx)(o.t,{}),!!P&&(0,n.jsx)(l.B7,{name:null==P?void 0:P.name,size:92,src:null==P?void 0:P.avatar_file_name}),C("Chat.sign-up-to-chat-with-character-name",{character:null==P?void 0:P.name}),(0,n.jsx)(c.ZP,{}),(0,n.jsx)(d.O,{}),(0,n.jsx)(i.R,{})]})})]})]}):null}}}]);