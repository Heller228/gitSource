"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8707],{83895:function(e,t,a){a.d(t,{E:function(){return s},U:function(){return l}});var r=a(52322),n=a(62593);let s=e=>{let{name:t,className:a}=e;return(0,r.jsx)("p",{className:a,children:t})},l=e=>{let{name:t,href:a,referrer:l,characterId:i,className:c}=e;return(0,r.jsx)(n.Z,{href:a,analytics:{name:"linkHandled",properties:{link:a,referrer:l,character_id:i}},children:(0,r.jsx)(s,{name:t,className:c})})}},21565:function(e,t,a){var r=a(52322),n=a(57352),s=a(58920);t.Z=()=>(0,r.jsx)(n.E.div,{animate:"float",variants:{float:{y:["0%","-10%","0%"],transition:{duration:2,ease:"easeInOut",repeat:1/0}}},style:{display:"inline-block"},children:(0,r.jsx)(s.vah,{className:"size-24 text-muted-foreground"})})},83605:function(e,t,a){a.d(t,{Gn:function(){return m},f7:function(){return p},im:function(){return h},uB:function(){return f}});var r=a(52322),n=a(38837),s=a(83895),l=a(68741),i=a(94766),c=a(17063),o=a(27617),u=a(92262),d=a(98614);function m(e){let{characterId:t,characterPageUrl:a,className:i}=e,{character:o}=(0,u.XS)(t),d=!!a;return o?(0,r.jsxs)("div",{className:(0,c.cn)("flex gap-3",i),children:[d?(0,r.jsx)(n.lc,{name:o.name,size:40,src:o.avatar_file_name,href:a,referrer:"ChatCharacterInfo",characterId:t}):(0,r.jsx)(n.Ps,{name:o.name,size:40,src:o.avatar_file_name}),(0,r.jsxs)("div",{children:[d?(0,r.jsx)(s.U,{name:o.name,referrer:"ChatCharacterInfo",characterId:t,href:a,className:"font-semi-bold line-clamp-1 text-ellipsis break-anywhere overflow-hidden whitespace-normal"}):(0,r.jsx)(s.E,{name:o.name,className:"font-semi-bold line-clamp-1 text-ellipsis break-anywhere overflow-hidden whitespace-normal"}),(0,r.jsx)(l.f,{author:o.user__username})]})]}):(0,r.jsx)(h,{className:i})}function h(e){let{className:t}=e;return(0,r.jsxs)("div",{className:(0,c.cn)("flex gap-3",t),children:[(0,r.jsx)(i.O,{className:"h-12 w-12 rounded-sm"}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(i.O,{className:"w-20 h-5"}),(0,r.jsx)(i.O,{className:"w-32 h-4"})]})]})}function f(e){var t,a,i;let{characterId:c}=e,{t:m}=(0,d.$G)(),{character:h}=(0,u.XS)(c),f=o.nN.characterProfile(null!==(t=null==h?void 0:h.short_hash)&&void 0!==t?t:c),p=!!(null==h?void 0:h.short_hash);if(!h)return null;let x=o.Wj.formatNumber(null!==(a=null==h?void 0:h.participant__num_interactions)&&void 0!==a?a:0);return(0,r.jsxs)("div",{className:"flex gap-3",children:[p?(0,r.jsx)(n.lc,{name:h.name,size:68,src:h.avatar_file_name,href:f,referrer:"ChatCharacterInfoDetailed",characterId:c}):(0,r.jsx)(n.Ps,{name:h.name,size:68,src:h.avatar_file_name}),(0,r.jsxs)("div",{className:"flex-col flex gap-1",children:[p?(0,r.jsx)(s.U,{className:"font-semi-bold",name:h.name,href:f,referrer:"ChatCharacterInfoDetailed",characterId:c}):(0,r.jsx)(s.E,{className:"font-semi-bold",name:h.name}),(0,r.jsx)(l.f,{author:h.user__username}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground flex gap-1",title:m("Common.character-interactions"),children:m("Common.num-chats",{num:x,count:null!==(i=null==h?void 0:h.participant__num_interactions)&&void 0!==i?i:0})})]})]})}function p(e){let{className:t}=e;return(0,r.jsxs)("div",{className:(0,c.cn)("flex gap-3",t),children:[(0,r.jsx)(i.O,{className:"h-16 w-16 rounded-sm"}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(i.O,{className:"w-24 h-5"}),(0,r.jsx)(i.O,{className:"w-32 h-3"}),(0,r.jsx)(i.O,{className:"w-16 h-3"})]})]})}},52370:function(e,t,a){a.d(t,{JE:function(){return m},Og:function(){return d}});var r=a(22094),n=a(25706),s=a(2236),l=a(2784),i=a(98614),c=a(15584);let o=(0,c.td)(!1),u="",d=e=>{e?u!==e&&(u=e,o.value=!0):o.value=!0},m=(e,t)=>{let{t:a}=(0,i.$G)(),{deleteMessages:o}=(0,s.m)(),u=(0,c.BF)(n.B$),d=(0,c.BF)(n.WK);(0,l.useEffect)(()=>{if(!e||!u||!t)return;let s=e[e.length-u-1];s&&o(t,[s.turn_key.turn_id],()=>{(0,r.K)(a("Chat.delete-successful"),5e3,"destructive")}),n.B$.value=null},[t,e,o,u,a]),(0,l.useEffect)(()=>{if(!e||!d||!t)return;let s=e.slice(0,e.length-d-1).map(e=>e.turn_key.turn_id);(null==s?void 0:s.length)&&o(t,s,()=>{(0,r.K)(a("Chat.rewind-successful"),void 0)}),n.WK.value=null},[t,e,o,d,a])}},39783:function(e,t,a){a.d(t,{JB:function(){return A},jW:function(){return W},QT:function(){return M},F6:function(){return G}});var r=a(52322),n=a(44460),s=a(63554),l=a(71126),i=a(48683),c=a(74943),o=a(23279),u=a(90122),d=a(94766),m=a(91262),h=a(566),f=a(7649),p=a(36562),x=a(60614),v=a(18818),g=a(25706),j=a(17380);a(22154);let C=e=>{var t,a;return!!e&&!(null==e?void 0:null===(a=e.user)||void 0===a?void 0:null===(t=a.account)||void 0===t?void 0:t.onboarding_complete)};var N=a(19206);a(76193);var _=a(76492),b=a(95112),y=a(77257),w=a(98614);function I(){let{generateReplyIdea:e,isReplyIdeaLoading:t,suggestedReplies:a}=(0,y.a)(),{t:s}=(0,w.$G)();return a.length>0?null:(0,r.jsx)(b.l,{content:s("Chat.reply-idea"),side:"top",children:(0,r.jsxs)(o.zx,{onPress:()=>{n.iN.elementClicked({referrer:"ChatActionReplyIdeaCompact",action:"generate_reply_idea"}),e()},variant:"ghost",isIconOnly:!0,isDisabled:t,className:"hover:bg-surface-elevation-3",children:[!t&&(0,r.jsx)(u.An,{className:"size-6 text-muted-foreground"}),!!t&&(0,r.jsx)("div",{className:"size-6",children:(0,r.jsx)(_.$,{size:16})})]})})}var E=a(2784);function k(){let{isStaff:e}=(0,h.a)();return e?(0,r.jsx)(I,{}):null}var S=a(60836),O=a(17063);let B=()=>{let{t:e}=(0,w.$G)(),[t,a]=(0,E.useState)(!1),{character:l}=(0,f.AU)(),c=(0,i.wz)(s.b.CharacterCallsWeb);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.WB,{open:t,setOpen:a,referrer:"ChatInputCallButton"}),(0,r.jsx)(b.l,{content:c?e("Calls.call-name",{name:null==l?void 0:l.name}):e("Calls.calls-available-on-the-app"),side:"top",className:"text-center text-sm",children:(0,r.jsx)(o.zx,{isIconOnly:!0,variant:"outline",className:"-ml-2 bg-background",onPress:()=>{c?(n.iN.elementClicked({referrer:"ChatInputCallButton",character_id:null==l?void 0:l.external_id,action:"call_button_pressed"}),g.tI.value=!0):(a(!0),n.iN.elementClicked({referrer:"ChatInputCallButton",character_id:null==l?void 0:l.external_id,action:"call_button_get_app_pressed"}))},children:(0,r.jsx)(u.lU,{className:(0,O.cn)("w-5 h-5",{"opacity-25":!c})})})})]})};var R=a(2236),z=a(69937),U=a(16538),D=a(53111),$=a(99629),F=a(66582),P=a(34543),T=a(15584);function A(e){var t,a;let{streamingStatus:c,onSendText:o,chatId:u}=e,{t:d}=(0,w.$G)(),{user:m}=(0,h.a)(),{unrecoverableErrorOccurred:_}=(0,x.Bo)(),b=(0,T.BF)(g.k5),{clearSuggestions:I}=(0,y.a)(),k=j.h.useUtils(),{characterId:S,character:O}=(0,f.AU)(),[B,U]=(0,E.useState)(!1),{publish:F}=(0,R.m)(),{isVoiceEnabled:P,expectCharacterSpeech:A,abortCharacterSpeech:G}=(0,p.AW)(),M=(0,T.BF)(g.LT),K=null===(t=(0,i.i)(s.b.CaiPlusUpsellChatTurboUpgrade))||void 0===t?void 0:t.payload,q=null===(a=(0,i.i)(s.b.EnforceMessageQuota))||void 0===a?void 0:a.payload,{isQuotaExceeded:Q,refetchQuota:H}=(0,z.pD)({quotaOptions:K,user:m}),{refetchQuota:J,isActivelyThrottled:L}=(0,z.pD)({quotaOptions:q,user:m,supportsThrottledAnimation:!0}),[X,Z]=(0,E.useState)(!0),[V,Y]=(0,E.useState)("");(0,E.useEffect)(()=>{let e=(0,N.mu)(S),t=localStorage.getItem(e);try{if(t){let{value:a,time:r}=JSON.parse(t);a&&1>(0,$.A)(new Date(r),new Date)&&Y(a),localStorage.removeItem(e)}}catch(e){(0,l.H)("Failed to retrieve previously typed value",{error:e})}},[S]);let ee=(0,D.fB)(V,1e3);(0,E.useEffect)(()=>{g.yc.value=Date.now()},[ee]),(0,E.useEffect)(()=>{null!=b&&(Y(b),g.k5.value=null)},[b]),(0,E.useEffect)(()=>{Q&&n.iN.contentViewed({referrer:"Chat",type:"turbo_upsell"})},[Q]);let et=(0,E.useCallback)(()=>{if(!S||"streaming"!==c&&L)return;let e="none"!==c;if(e&&F(S,{type:"abort"}),M){G();return}!e&&(I(),F(S,{type:"create_and_generate",message:V,ttsEnabled:P}),Y(""),A(),B||(U(!0),k.discovery.recent.invalidate()),o&&o(),J(),H(),X&&(Z(!1),n.iN.messageSend({type:"text_first",character_id:S,chat_id:u||void 0,referrer:"ChatInput"})))},[L,G,S,u,I,A,B,V,M,X,P,o,F,J,H,c,k.discovery.recent]),{resolveExampleChatPrompt:ea}=(0,x.a3)({setInputText:Y});(0,E.useEffect)(()=>{ea()},[ea]);let er=P?M:"streaming"===c||L,en="waiting"===c||C(m),es=(0,v.Dv)(),el=(0,E.useMemo)(()=>es?d("Chat.message"):O?d("Chat.message-char",{char:O.name}):d("Chat.send-a-message"),[O,es,d]);return(0,r.jsx)(W,{onSend:et,showStopButton:er,disableSubmitButton:en,placeholder:el,inputText:V,setInputText:Y,unrecoverableErrorOccurred:_,isQuotaExceeded:Q})}let G=e=>{let{onSend:t}=e,{t:a}=(0,w.$G)(),[n,s]=(0,E.useState)(""),{resolveExampleChatPrompt:l}=(0,x.a3)({setInputText:s});return(0,E.useEffect)(()=>{l()},[l]),(0,r.jsx)(W,{showStopButton:!1,disableSubmitButton:!1,onSend:()=>t(n),placeholder:a("Chat.send-a-message"),inputText:n,setInputText:e=>s(e),unrecoverableErrorOccurred:!1})},W=e=>{let{showStopButton:t,disableSubmitButton:a,onSend:s,placeholder:l,inputText:i,setInputText:d,unrecoverableErrorOccurred:h,disableReplyIdeas:f,disableBorder:p,disableCalls:x,isQuotaExceeded:v}=e,{t:j}=(0,w.$G)(),C=(0,E.useRef)(!1),N=(0,E.useRef)(null);return h?(0,r.jsxs)("div",{className:"flex flex-col items-center m-4",children:[(0,r.jsx)("p",{className:"bold",children:j("Error.something-went-wrong")}),(0,r.jsx)("p",{children:j("Error.please-refresh-or-try-again-later")})]}):(0,r.jsxs)("div",{className:"w-full flex items-center self-center h-fit flex-col max-w-3xl pb-4 z-10",children:[!!v&&(0,r.jsxs)("div",{className:"flex items-center text-muted-foreground text-[0.70rem] select-none",children:[(0,r.jsxs)("span",{className:"flex items-center cursor-pointer",onClick:()=>{g.Um.value={referrer:"Chat",trigger:"turbo_upsell"},n.iN.modalOpened({referrer:"ChatInput",type:"Upgrade-for-faster-response-times"})},children:[(0,r.jsx)(P.Wqx,{className:"mr-1",color:"var(--plus-blue)"}),(0,r.jsx)("span",{className:"text-primary font-bold mr-1",style:{color:"var(--plus-blue)"},children:j("Chat.upgrade")})]}),(0,r.jsx)("span",{children:j("Chat.upgrade-suffix--for-faster-response-times")})]}),(0,r.jsxs)("div",{className:"w-full flex justify-center items-center pr-4",children:[(0,r.jsxs)("div",{className:(0,U.cn)("flex grow items-end p-1 rounded-sm placeholder:text-placeholder bg-surface-elevation-1 m-4",p?"":"border-solid border-1 border-border-outline"),children:[(0,r.jsx)(m.g,{autoFocus:!F.tq,ref:N,containerClassName:"ml-2",className:"text-lg border-none bg-surface-elevation-1 placeholder:text-placeholder placeholder:overflow-hidden placeholder:whitespace-nowrap",inputMode:"text",placeholder:l,onChange:e=>d(e.target.value),value:i,onCompositionStart:()=>{C.current=!0},onCompositionEnd:()=>{C.current=!1},onKeyDown:e=>{F.tq||C.current||"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s())},chatMode:!0}),(0,r.jsxs)("div",{className:"flex gap-3",children:[!i&&!f&&(0,r.jsx)(k,{}),(0,r.jsxs)(o.zx,{"aria-label":j("Chat.send-a-message"),isDisabled:a,disableAnimation:!0,disableRipple:!0,onPressStart:()=>{var e;s(),null===(e=N.current)||void 0===e||e.focus()},isIconOnly:!0,children:[!t&&(0,r.jsx)(c.a2,{children:(0,r.jsx)(u.aI,{height:"1.25em",color:"var(--icon-inverted)"})}),!!t&&(0,r.jsx)(c.a2,{children:(0,r.jsx)(u.wN,{height:"1.25em",color:"var(--icon-inverted)"})})]})]})]}),!i&&!x&&(0,r.jsx)(B,{})]}),(0,r.jsx)("p",{className:"text-muted-foreground text-[0.70rem] select-none",children:j("Common.remember-everything-characters-say-are-made-up")})]})};function M(){return(0,r.jsx)(d.O,{className:"flex items-end p-1 mx-6 rounded-sm h-12"})}},77257:function(e,t,a){a.d(t,{B:function(){return m},a:function(){return d}});var r=a(52322),n=a(71126),s=a(17380),l=a(2784);let i={generateReplyIdea:()=>{},suggestedReplies:[],clearSuggestions:()=>{},isReplyIdeaLoading:!1},c=(0,l.createContext)(i),o=e=>{let{chatTurns:t,primaryCandidateMap:a,children:i}=e,{mutateAsync:o,isLoading:u}=s.h.gen.replyIdeas.useMutation(),[d,m]=(0,l.useState)([]),h=(0,l.useCallback)(async()=>{let e="".concat(t.slice(0,t.length>3?3:t.length-1).map(e=>"".concat(e.author.is_human?"USER":e.author.name,": ").concat(a[e.turn_key.turn_id]?e.candidates[a[e.turn_key.turn_id]]:e.candidates[0].raw_content)).reverse().join("\n\n"),"\nUSER:"),r=await o({content:e});if(r.suggestedReplies)try{m([r.suggestedReplies])}catch(e){(0,n.H)("Failed to parse json while generating reply idea",{error:e,extra:{suggestedReplies:r.suggestedReplies}})}},[t,o,a]),f=(0,l.useCallback)(()=>{m([])},[]),p=(0,l.useMemo)(()=>({generateReplyIdea:h,suggestedReplies:d,clearSuggestions:f,isReplyIdeaLoading:u}),[h,d,f,u]);return(0,r.jsx)(c.Provider,{value:p,children:i})},u=e=>{let{chatTurns:t,primaryCandidateMap:a,children:n}=e;return(0,r.jsx)(c.Provider,{value:i,children:n})},d=()=>(0,l.useContext)(c),m=e=>{let{chatTurns:t,primaryCandidateMap:a,children:n,condition:s}=e;return(0,r.jsx)(s?o:u,{chatTurns:t,primaryCandidateMap:a,children:n})}}}]);