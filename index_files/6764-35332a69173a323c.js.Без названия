"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6764],{8368:function(e,n,t){t.d(n,{D:function(){return h},z:function(){return m}});var a=t(52322),s=t(77828),i=t(90122),o=t(23279),r=t(47843),l=t(25706),c=t(71338),d=t(98614),u=t(15584);let h=e=>{let{report:n,showText:t,className:s,variant:r}=e,{t:c}=(0,d.$G)();return(0,a.jsxs)(o.zx,{variant:r||"outline",isIconOnly:!t,className:s,"aria-label":c("Common.report"),onPress:()=>{l.mr.value=!0,l.a5.value=n},children:[!!t&&c("Common.report"),(0,a.jsx)(i.cW,{className:"size-4 text-muted-foreground"})]})};function m(e){var n;let{room:t,referrer:h}=e,m=(0,u.BF)(l.mr),{t:x}=(0,d.$G)(),f=null!==(n=(0,u.BF)(l.a5))&&void 0!==n?n:{type:c.C.ROOM,room:t};return(0,a.jsxs)(r.Vq,{open:m,onOpenChange:e=>{l.mr.value=e},analyticsProps:{referrer:h,type:"ReportCharacterDialog"},children:[(0,a.jsx)(r.hg,{asChild:!0,children:(0,a.jsx)(o.zx,{variant:"outline",isIconOnly:!0,"aria-label":x("Common.report"),children:(0,a.jsx)(i.cW,{className:"size-4 text-muted-foreground"})})}),(0,a.jsx)(s.o,{isOpen:m,title:x("Common.report"),report:f,onComplete:()=>{l.mr.value=!1,l.a5.value=void 0}})]})}},88070:function(e,n,t){t.d(n,{X:function(){return l}});var a=t(52322),s=t(23681),i=t(2784),o=t(90122),r=t(17063);let l=i.forwardRef((e,n)=>{let{className:t,...i}=e;return(0,a.jsx)(s.fC,{ref:n,className:(0,r.cn)("peer h-4 w-4 shrink-0 rounded-spacing-xxs border border-primary disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...i,children:(0,a.jsx)(s.z$,{className:(0,r.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(o.KM,{className:"h-2 w-2"})})})});l.displayName=s.fC.displayName},46870:function(e,n,t){t.d(n,{U:function(){return i}});var a=t(52322),s=t(94766);function i(){return(0,a.jsxs)("div",{className:"my-2 flex h-10 gap-1 p-2 pl-4 items-start",children:[(0,a.jsx)(s.O,{className:"mr-1 h-6 w-6 rounded-sm"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(s.O,{className:"w-32 h-5"}),(0,a.jsx)(s.O,{className:"w-64 h-12 rounded-spacing-s"})]})]})}},80147:function(e,n,t){t.d(n,{x:function(){return e_}});var a=t(52322),s=t(60614),i=t(17063),o=t(23279),r=t(98614),l=t(18978),c=t(59611),d=t(74943);function u(e){let{index:n,filled:t,onPress:s,isDisabled:i}=e,{t:u}=(0,r.$G)();return(0,a.jsx)(o.zx,{"aria-label":u("Common.rate",{number:n+1}),isIconOnly:!0,isDisabled:i,onPress:s,variant:"ghost",className:"w-6 h-6 min-w-unit-0 p-1 data-[hover=true]:bg-transparent",children:(0,a.jsx)(d.a2,{children:t?(0,a.jsx)(c.QJe,{size:16}):(0,a.jsx)(l.jJN,{color:"var(--icon-secondary)",size:16})},"star".concat(t))})}var h=t(44460),m=t(63554),x=t(48683),f=t(47843),g=t(76727),p=t(13074),v=t(91262),_=t(98577),b=t(25706),y=t(92526),j=t(2784),w=t(88070);let k=e=>({boring:e("feedback-utils.boring"),not_boring:e("feedback-utils.not-boring"),inaccurate:e("feedback-utils.not-true"),not_inaccurate:e("feedback-utils.true"),repetitive:e("feedback-utils.repetitive"),not_repetitive:e("feedback-utils.not-repetitive"),out_of_character:e("feedback-utils.out-of-character"),not_out_of_character:e("feedback-utils.not-out-of-character"),good_memory:e("feedback-utils.good-memory"),bad_memory:e("feedback-utils.bad-memory"),not_bad_memory:e("feedback-utils.not-bad-memory"),long:e("feedback-utils.too-long"),not_long:e("feedback-utils.not-too-long"),short:e("feedback-utils.too-short"),not_short:e("feedback-utils.not-too-short"),ends_chat_early:e("feedback-utils.ends-chat-early"),not_ends_chat_early:e("feedback-utils.not-ends-chat-early"),funny:e("feedback-utils.funny"),not_funny:e("feedback-utils.not-funny"),interesting:e("feedback-utils.interesting"),not_interesting:e("feedback-utils.not-interesting"),helpful:e("feedback-utils.helpful"),not_helpful:e("feedback-utils.not-helpful"),voice_wrong_voice:e("feedback-utils.voice-wrong-voice"),voice_low_quality:e("feedback-utils.voice-low-quality"),voice_incorrect_pronounciation:e("feedback-utils.voice-incorrect-pronounciation"),voice_repeated_words:e("feedback-utils.voice-repeated-words"),voice_missing_words:e("feedback-utils.voice-missing-words"),voice_too_fast:e("feedback-utils.voice-too-fast"),voice_too_slow:e("feedback-utils.voice-too-slow"),annotations_sexually_suggestive_pg:e("Annotation.annotations-sexually-suggestive-pg"),annotations_sexually_suggestive_pg_13:e("Annotation.annotations-sexually-suggestive-pg-13"),annotations_sexually_suggestive_r:e("Annotation.annotations-sexually-suggestive-r"),annotations_sexually_suggestive_x:e("Annotation.annotations-sexually-suggestive-x"),annotations_repetitive:e("Annotation.annotations-repetitive"),annotations_nonsense:e("Annotation.annotations-nonsense"),annotations_looping:e("Annotation.annotations-looping"),annotations_out_of_character:e("Annotation.annotations-out-of-character"),annotations_harmful_promotes_selfharm:e("Annotation.annotations-harmful-promotes-selfharm"),annotations_harmful_promotes_terrorism:e("Annotation.annotations-harmful-promotes-terrorism"),annotations_inaccurate:e("Annotation.annotations-inaccurate"),annotations_forgets_context:e("Annotation.annotations-forgets-context"),annotations_technology:e("Annotation.annotations-technology"),annotations_creative_arts:e("Annotation.annotations-creative-arts"),annotations_math:e("Annotation.annotations-math"),annotations_science:e("Annotation.annotations-science"),annotations_social_studies:e("Annotation.annotations-social_studies"),annotations_code:e("Annotation.annotations-code"),annotations_business:e("Annotation.annotations-business"),annotations_philosophy:e("Annotation.annotations-philosophy"),annotations_language_learning:e("Annotation.annotations-language-learning"),annotations_emotional_support:e("Annotation.annotations-emotional-support"),annotations_friendship:e("Annotation.annotations-friendship"),annotations_planning:e("Annotation.annotations-planning"),annotations_life_advice:e("Annotation.annotations-life-advice"),annotations_recommendation:e("Annotation.annotations-recommendation"),annotations_hobbies:e("Annotation.annotations-hobbies"),annotations_interactive_story_telling:e("Annotation.annotations-interactive-story-telling"),annotations_story_telling:e("Annotation.annotations-story-telling"),annotations_comedy:e("Annotation.annotations-comedy"),annotations_discussion:e("Annotation.annotations-discussion"),annotations_gameplay:e("Annotation.annotations-gameplay"),annotations_hate_speech:e("Annotation.annotations-hate-speech"),annotations_disturbing_sexually:e("Annotation.annotations-disturbing-sexually"),annotations_disturbing_violence:e("Annotation.annotations-disturbing-violence"),annotations_regulated_controlled_substances:e("Annotation.annotations-regulated-controlled-substances"),annotations_criminal_activity_planning:e("Annotation.annotations-criminal-activity-planning"),annotations_service_breaking_behavior:e("Annotation.annotations-service-breaking-behavior"),annotations_writing_mistake:e("Annotation.annotations-writing-mistake"),annotations_unsafe_eating:e("Annotation.annotations-unsafe-eating"),annotations_discusses_eating_disorder:e("Annotation.annotations-discusses-eating-disorder"),annotations_harmful_discusses_selfharm:e("Annotation.annotations-harmful-discusses-selfharm"),annotations_child_violence:e("Annotation.annotations-child-violence"),annotations_csam:e("Annotation.annotations-csam"),annotations_underage_sex:e("Annotation.annotations-underage-sex"),annotations_harassment:e("Annotation.annotations-harassment"),annotations_kinks_fetishes:e("Annotation.annotations-kinks-fetishes"),annotations_medical_advice:e("Annotation.annotations-medical-advice")}),C="star",N="custom",A=["funny","interesting","helpful","good_memory"],I=["boring","inaccurate","repetitive","out_of_character","bad_memory","long","short","ends_chat_early"],P=["voice_wrong_voice","voice_low_quality","voice_incorrect_pronounciation","voice_repeated_words","voice_missing_words","voice_too_fast","voice_too_slow"];function E(e){let{id:n,disabled:t,label:s,onClick:i,isSelected:o}=e,{t:l}=(0,r.$G)();return(0,a.jsxs)(_.G,{className:"flex justify-start text-start h-7 md:h-10 bg-transparent w-2/5 gap-3 data-[state=on]:bg-transparent",onClick:i,disabled:t,value:s,children:[(0,a.jsx)(w.X,{id:n,className:o?void 0:"opacity-50",color:o?void 0:"var(--muted-foreground)",checked:o}),k(l)[s]]})}function F(e){let{labels:n,selectedPills:t,togglePillSelection:s,disabled:i}=e;return(0,a.jsx)(_.t,{type:"multiple",className:"flex flex-wrap text-foreground text-sm md:text-md align-top justify-start w-full",children:n.map(e=>(0,a.jsx)(E,{label:e,isSelected:t.includes(e),onClick:()=>s(e),disabled:i},e))})}function S(e){let{selectedPills:n,customFeedback:t,togglePillSelection:s,saveCustomFeedback:i,rating:l,isOpen:c,isReadOnly:d}=e,{t:u}=(0,r.$G)(),[_,w]=(0,j.useState)(t),[k,C]=(0,j.useState)(!1),N=b.sF.value,[E,S]=(0,j.useState)(N?"voice":"text");(0,j.useEffect)(()=>w(t),[t]),(0,j.useEffect)(()=>{k&&h.iN.contentViewed({referrer:"CandidateFeedbackDialogContent"})},[k]);let O=(0,x.wz)(m.b.SmartCustomFeedbackLabelOrdering)&&l>=3;return(0,a.jsxs)(f.Vq,{open:null!=c?c:k,onOpenChange:C,analyticsProps:{referrer:"Chat",type:"CandidateFeedbackDialog"},children:[(0,a.jsx)(f.hg,{asChild:!0,children:(0,a.jsx)("div",{className:"text-sm bg-surface-elevation-3 rounded-full px-2 mt-1 py-1 hover:bg-accent cursor-pointer",onClick:()=>C(!0),children:u("Feedback.tell-us-more")})}),(0,a.jsxs)(f.cZ,{className:"w-full max-w-xl",children:[(0,a.jsx)(f.fK,{children:(0,a.jsx)(f.$N,{children:u("Feedback.feedback")})}),(0,a.jsxs)(f.Be,{className:"gap-2 flex flex-col justify-center",children:[(0,a.jsxs)(p.mQ,{value:E,tabIndex:-1,onValueChange:e=>S(e),children:[!!N&&(0,a.jsxs)(p.dr,{className:"px-4",children:[(0,a.jsx)(p.SP,{value:"voice",children:u("Feedback.voice-feedback")}),(0,a.jsx)(p.SP,{value:"text",children:u("Feedback.text-feedback")})]}),(0,a.jsx)(p.nU,{value:"voice",children:(0,a.jsx)(F,{labels:P,selectedPills:n,togglePillSelection:s,disabled:d})}),(0,a.jsxs)(p.nU,{value:"text",children:[(0,a.jsx)(F,{labels:O?A:I,selectedPills:n,togglePillSelection:s,disabled:d}),(0,a.jsx)(g.Z,{className:"my-3"}),(0,a.jsx)(F,{labels:O?I:A,selectedPills:n,togglePillSelection:s,disabled:d})]})]}),(0,a.jsx)(v.g,{className:"text-md items-center bg-transparent text-foreground mt-1",onChange:e=>{w(e.target.value)},value:_,disabled:d,autoFocus:!1,maxLength:y.zn.CUSTOM_FEEDBACK_MAX_LEN,label:u("Feedback.anything-else"),placeholder:u("Common.optional")})]}),(0,a.jsxs)(f.cN,{className:"sm:justify-end",children:[(0,a.jsx)(f.GG,{asChild:!0,children:(0,a.jsx)(o.zx,{type:"button",onPress:()=>{w(t),C(!1)},variant:"ghost",children:u("Common.cancel")})}),(0,a.jsx)(f.GG,{asChild:!0,children:(0,a.jsx)(o.zx,{type:"button",onPress:()=>{i(_),C(!1)},isDisabled:d||t===_,children:u("Feedback.save-details")})})]})]})]})}var O=t(71126),z=t(41332);let G=(e,n,t)=>{var a,s;let{addAnnotation:i,removeAnnotation:o,updateAnnotation:r,annotationsByType:l}=(0,z.O2)(e,n),[c,d]=(0,j.useState)(-1);(0,j.useEffect)(()=>{var e,n;let t=Number(null!==(n=null===(e=l[C])||void 0===e?void 0:e.annotation_value)&&void 0!==n?n:-1);d(Number.isNaN(t)||t>4||t<-1?-1:t)},[l]);let u=(0,j.useCallback)(e=>{let n=e+1;if(d(n),c===n){o(C);return}r({annotation_type:C,annotation_value:n}),t||h.iN.elementClicked({referrer:"CandidateFeedbackComponent",type:"star_rating"})},[o,r,c,t]),[m,x]=(0,j.useState)([]);(0,j.useEffect)(()=>{x([...A,...I,...P].filter(e=>!!l[e]))},[l]);let f=(0,j.useCallback)(e=>{if(m.includes(e)){x(n=>n.filter(n=>n!==e)),o(e);return}x(n=>[...n,e]),i({annotation_type:e}),t||h.iN.elementClicked({referrer:"CandidateFeedbackComponent",type:"select_pill",rating:c,pill_name:e})},[c,i,o,m,t]);return{rating:c,toggleRating:u,selectedPills:m,togglePill:f,customFeedback:null!==(s=null===(a=l[N])||void 0===a?void 0:a.annotation_raw_content)&&void 0!==s?s:"",updateCustomFeedback:(0,j.useCallback)(e=>{try{e?r({annotation_type:N,annotation_raw_content:e}):o(N),t||h.iN.elementClicked({referrer:"CandidateFeedbackComponent",type:"custom_feedback"})}catch(e){(0,O.H)("Failed to leave custom feedback",{error:e})}},[r,o,t])}},T=e=>{let{rating:n,onRatingPress:t,isReadOnly:s}=e;return(0,a.jsx)(o.hE,{isIconOnly:!0,className:"h-6",children:[void 0,void 0,void 0,void 0].map((e,i)=>(0,a.jsx)(u,{index:i,filled:i<n,onPress:()=>t(i),isDisabled:s},i))})};function $(e){let{turnKey:n,candidateId:t,disableAmpli:s,isReadOnly:i}=e,{rating:o,toggleRating:r,selectedPills:l,togglePill:c,customFeedback:d,updateCustomFeedback:u}=G(n,t,s),h=-1!==o;return(0,a.jsxs)("div",{className:"flex flex-1 justify-start items-center gap-2 ",children:[(0,a.jsx)(T,{onRatingPress:r,rating:o,isReadOnly:i}),!!h&&(0,a.jsx)(S,{customFeedback:d,saveCustomFeedback:u,selectedPills:l,togglePillSelection:c,rating:o,isReadOnly:i})]})}var M=t(90122),D=t(19206);function R(e){let{listIndex:n,listCount:t,swipe:s}=e,{t:l}=(0,r.$G)(),c=t===n+1;return c?null:n>=D.U$-1?(0,a.jsx)("div",{className:"w-2"}):(0,a.jsxs)(o.zx,{"aria-label":l("Common.next"),autoFocus:!1,isDisabled:c,onPress:()=>s(!1),className:(0,i.cn)("h-8 w-8 min-w-unit-2 data-[hover=true]:bg-transparent",2===t?"h-8 w-8":"h-6 w-6 text-muted-foreground"),isIconOnly:!0,variant:"ghost",children:[2===t&&(0,a.jsx)(d.a2,{children:(0,a.jsx)(M.Vk,{height:"18px",width:"18px"})}),t>2&&(0,a.jsx)(d.a2,{children:(0,a.jsx)(M.VQ,{height:"16px",width:"16px"})})]})}function L(e){let{listIndex:n,swipe:t}=e,{t:s}=(0,r.$G)(),i=0===n;return i?null:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.zx,{"aria-label":s("Common.back"),autoFocus:!1,isDisabled:i,variant:"ghost",isIconOnly:!0,className:"h-6 w-6 min-w-unit-2 p-1 data-[hover=true]:bg-transparent text-muted-foreground ",onPress:()=>t(!0),children:(0,a.jsx)(M.bf,{height:"16px",width:"16px"})}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground font-extralight",children:[n+1," / ",D.U$]})]})}var B=t(2236);let q=e=>{let{turn:n,candidate:t}=e,{publish:s}=(0,B.m)(),i=!n.author.is_human&&!!t.is_final&&!!t.raw_content;return(0,a.jsxs)("div",{className:"flex md:ml-14 absolute -bottom-5 items-center",children:[(0,a.jsx)(R,{swipe:()=>{s(n.turn_key.chat_id,{type:"generate_room_candidate",characterId:n.author.author_id,turnId:n.turn_key.turn_id})},listIndex:0,listCount:2}),!!i&&(0,a.jsx)($,{turnKey:n.turn_key,candidateId:t.candidate_id})]})};var K=t(47605),U=t(5813),V=t(97679),H=t(7702),W=t(36562);let Z=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.max(t,Math.min(e,n))};var X=t(52370),Q=t(15584);let J=[V.gI],Y={prev:{opacity:0,translate:[0,0,-400]},next:{translate:["100%",0,0]}};function ee(e){var n;let{turn:t,primaryCandidateIndex:s,supportsThrottledAnimation:i}=e,o=Z(s||0,t.candidates.length),{publish:r,updatePrimaryCandidateMap:l,subscribeChatEvents:c}=(0,B.m)(),[d,u]=(0,j.useState)(o),h=(0,j.useRef)(null);et(h);let{isVoiceEnabled:m,expectCharacterSpeech:x,abortCharacterSpeech:f}=(0,W.AW)(),g=(0,Q.BF)(b.LT),[p,v]=(0,j.useState)(!1),_=(0,j.useRef)(null===(n=t.candidates[t.candidates.length-1])||void 0===n?void 0:n.candidate_id);(0,j.useEffect)(()=>c(U.qN.message_edited,(e,n)=>{let{turnId:a,editedIndex:s}=n;if(t.turn_key.turn_id&&t.turn_key.turn_id===a&&s>-1){var i;null===(i=h.current)||void 0===i||i.swiper.slideTo(s)}}),[c,t.isLastAiMessage,t.turn_key.turn_id]);let y=(0,j.useCallback)(()=>{var e;null===(e=h.current)||void 0===e||e.swiper.update()},[]);(0,j.useEffect)(()=>{var e;t.candidates.length>=0&&(null===(e=t.candidates[t.candidates.length-1])||void 0===e?void 0:e.candidate_id)!==_.current&&(_.current=t.candidates[t.candidates.length-1].candidate_id,v(!1))},[t.candidates.length,t.candidates]);let w=t.candidates.slice(0,31),k=w.some(e=>!e.is_final);k||w.push({candidate_id:U.gn,create_time:""});let C=(0,j.useCallback)(e=>{(0,X.Og)(),u(e.snapIndex),l(t.author.author_id,t.turn_key.turn_id,e.snapIndex),e.snapIndex!==t.candidates.length||k||p||(g&&f(),r(t.author.author_id,{type:"generate_candidate",ttsEnabled:m}),v(!0),x())},[l,t.author.author_id,t.turn_key.turn_id,t.candidates.length,k,p,r,g,m,x,f]),N=(0,j.useCallback)(e=>{var n,t,a,s;e?null===(t=h.current)||void 0===t||null===(n=t.swiper)||void 0===n||n.slidePrev():null===(s=h.current)||void 0===s||null===(a=s.swiper)||void 0===a||a.slideNext()},[]),A=(0,j.useMemo)(()=>w.map((e,n)=>{let s=!t.author.is_human&&d===n&&!!e.is_final&&!!e.raw_content;return(0,a.jsx)(H.o5,{children:(0,a.jsx)(en,{idx:n,showFeedback:s,listCount:w.length,swipe:N,candidate:e,turn:t,onHeightChange:y,supportsThrottledAnimation:i})},e.candidate_id)}),[w,d,y,N,i,t]);return(null==t?void 0:t.candidates)&&0!==t.candidates.length?(0,a.jsx)("div",{className:"p-2 min-h-32",children:(0,a.jsx)(H.tq,{autoHeight:!0,className:"flex flex-1",initialSlide:o,onSlideChange:C,ref:h,effect:"creative",creativeEffect:Y,modules:J,children:A})}):null}function en(e){let{candidate:n,turn:t,onHeightChange:s,idx:i,showFeedback:o,listCount:r,swipe:l,supportsThrottledAnimation:c}=e,d=(0,j.useRef)(null),u=(0,j.useRef)(null);return(0,j.useEffect)(()=>{var e;return null===(e=u.current)||void 0===e||e.disconnect(),d.current&&(u.current=new ResizeObserver(e=>{e[0]&&s()}),u.current.observe(d.current)),()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.disconnect()}},[i,s]),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{ref:d,children:[(0,a.jsx)(K.f,{candidate:n,turn:t,includeWaveForm:!0,animate:!0,supportsThrottledAnimation:c}),(0,a.jsx)("div",{className:"h-8"})]}),(0,a.jsx)(ea,{candidate:n,turn:t,idx:i,showFeedback:o,listCount:r,swipe:l})]})}let et=e=>{let n=(0,j.useCallback)(n=>{var t,a,s,i;let{activeElement:o}=document;if((null==o?void 0:o.tagName)!=="INPUT"&&(null==o?void 0:o.tagName)!=="TEXTAREA"||""===o.value)switch(n.key){case"ArrowLeft":null===(a=e.current)||void 0===a||null===(t=a.swiper)||void 0===t||t.slidePrev(),n.preventDefault();break;case"ArrowRight":null===(i=e.current)||void 0===i||null===(s=i.swiper)||void 0===s||s.slideNext(),n.preventDefault()}},[e]);(0,j.useEffect)(()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}),[n])};function ea(e){let{candidate:n,turn:t,idx:s,showFeedback:i,listCount:o,swipe:r}=e;return(0,a.jsxs)("div",{className:"flex md:ml-14 absolute -bottom-0 items-center",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(L,{swipe:r,listIndex:s}),(0,a.jsx)(R,{swipe:r,listIndex:s,listCount:o})]}),!!i&&(0,a.jsx)($,{turnKey:t.turn_key,candidateId:n.candidate_id})]})}var es=t(8368),ei=t(76193),eo=t(71338),er=t(8799),el=t(65144);function ec(e){let{handleCopyChat:n}=e,{t}=(0,r.$G)();return(0,a.jsx)(o.zx,{variant:"ghost",className:"justify-between w-full rounded-spacing-s hover:bg-surface-elevation-2",onPress:n,endContent:(0,a.jsx)(M.jU,{className:"size-4"}),children:t("Chat.duplicate-conversation")},"copy-button")}var ed=t(27617);function eu(e){let{text:n}=e,{t}=(0,r.$G)(),s=(0,j.useRef)(n);return(0,j.useEffect)(()=>{let e=function(){let e="";if(window&&window.getSelection){var n;e=null===(n=window.getSelection())||void 0===n?void 0:n.toString()}return e}();e&&(s.current=e)},[]),(0,a.jsxs)(o.zx,{variant:"ghost",className:"justify-between w-full rounded-spacing-s hover:bg-surface-elevation-2",onPress:()=>{var e;ed.Wj.copyTextToClipboard(null!==(e=s.current)&&void 0!==e?e:"",t("Common.message-copied-to-clipboard"),"ChatMessage")},children:[t("Common.copy")," ",(0,a.jsx)(M.TI,{height:"1.25em"})]},"copy-button")}var eh=t(46367),em=t(7649);function ex(e){let{turnKey:n,isCurPinned:t}=e,{t:s}=(0,r.$G)(),{publish:i}=(0,B.m)(),{character:l}=(0,em.AU)(),{refetch:c}=(0,z.gL)(n.chat_id),d=(0,j.useCallback)(async()=>{if(!l)return;let e={type:"set_turn_pin",turnKey:n,isPinned:!t};h.iN.elementClicked({referrer:"PinMessageOption",...e}),i(l.external_id,e),await c()},[l,i,n,t,c]);return(0,a.jsx)(o.zx,{variant:"ghost",className:"justify-between w-full rounded-spacing-s hover:bg-surface-elevation-2",onPress:d,endContent:t?(0,a.jsx)(M.qQ,{height:"1.25em"}):(0,a.jsx)(M.sh,{height:"1.25em"}),children:s(t?"Chat.unpin-message":"Chat.pin-message")},"pin-button")}var ef=t(40040);let eg=e=>{let{isRoom:n}=(0,B.m)(),{listItemIndex:t,turn:s,candidate:i,isLastTurn:o,handleCopyChat:r}=e,l=!!s.is_pinned,c=(s.isLastAiMessage||s.isLastUserMessage)&&!l&&!l&&!n,d=(!(null==s?void 0:s.isLastAiMessage)||l)&&!n,u=!o&&!n,h=!n;return(0,j.useMemo)(()=>{if(void 0===t||!i||!i.is_final)return[];let e=[{content:(0,a.jsx)(eu,{text:i.raw_content}),asChild:!1,key:"copy"},{content:(0,a.jsx)(eh.n,{listIndex:t}),asChild:!1,key:"delete-dialog"}];return h&&e.push({content:(0,a.jsx)(ec,{handleCopyChat:r}),asChild:!1,key:"duplicate"}),u&&e.push({content:(0,a.jsx)(ef.q,{listIndex:t}),asChild:!1,key:"rewind-dialog"}),c&&e.push({content:(0,a.jsx)(el.K,{turn_id:s.turn_key.turn_id}),asChild:!1,key:"edit"}),n&&e.push({content:(0,a.jsx)(es.D,{showText:!0,variant:"ghost",report:{type:eo.C.MESSAGE,turn:s},className:"justify-between w-full rounded-spacing-s hover:bg-surface-elevation-2"}),asChild:!1,key:"report"}),d&&e.push({content:(0,a.jsx)(ex,{turnKey:s.turn_key,isCurPinned:l}),asChild:!1,key:"pin"}),e},[t,i,h,u,c,n,d,r,s,l])};function ep(e){let{listItemIndex:n,turn:t,candidate:l,isLastTurn:c,characterId:d}=e,{t:u}=(0,r.$G)(),{isDefaultChatStyle:h}=(0,s.ax)(),m=(0,s.NS)({chatId:t.turn_key.chat_id,endTurnId:t.turn_key.turn_id,characterId:d}),x=eg({listItemIndex:n,turn:t,candidate:l,isLastTurn:c,characterId:d,handleCopyChat:m}),[f,g]=(0,j.useState)(!1);return(0,a.jsx)("div",{className:(0,i.cn)("absolute right-6 top-0 z-40 group",t.author.is_human?"sm:right-6 left-4 sm:left-auto":"right-6",h?"sm:top-9":"top-0"),children:(0,a.jsx)(ei.C,{options:x,setIsOpen:g,isOpen:f,asChild:!0,children:(0,a.jsx)(o.zx,{"aria-label":u("Form.more-options"),variant:"ghost",isIconOnly:!0,onPress:()=>g(!f),className:(0,i.cn)("opacity-0 transition-all group-hover:opacity-100",{"opacity-100":f}),children:(0,a.jsx)(er.evw,{})})})})}var ev=t(39377);let e_=(0,j.memo)(e=>{let{characterId:n,turn:t,isLastTurn:s,primaryCandidateIndex:o,listItemIndex:r,containerClassName:l,isRoom:c,hasCustomBackground:d}=e,u=s&&!t.author.is_human&&!t.isGreetingMessage&&!t.is_pinned&&!c;if(t.clientSystemMessage)return(0,a.jsx)(eb,{className:l,children:(0,a.jsx)(ev.i,{turn:t,hasCustomBackground:d,chatInstanceId:n})});if(!(null==t?void 0:t.candidates)||0===t.candidates.length)return null;let h=c?t.candidates.length-1:Math.min(o||0,t.candidates.length-1),m=t.candidates[h];if(!m)return null;let x={isLastTurn:s,listItemIndex:r,turn:t,candidate:m,characterId:n};return u?(0,a.jsxs)(eb,{className:l,children:[(0,a.jsx)(ee,{turn:t,primaryCandidateIndex:o,supportsThrottledAnimation:!0}),(0,a.jsx)(ep,{...x})]}):(0,a.jsxs)(eb,{className:(0,i.cn)("p-2",l),children:[(0,a.jsx)(K.f,{candidate:m,turn:t,animate:!!s&&!!c}),(0,a.jsx)(ep,{...x}),!!c&&!!s&&!t.author.is_human&&(0,a.jsx)(q,{candidate:m,turn:t})]})},(e,n)=>e.characterId===n.characterId&&e.turn===n.turn&&e.isLastTurn===n.isLastTurn&&e.primaryCandidateIndex===n.primaryCandidateIndex&&e.listItemIndex===n.listItemIndex&&e.containerClassName===n.containerClassName);function eb(e){let{children:n,className:t}=e,{isDenseChatStyle:o}=(0,s.ax)();return(0,a.jsx)("div",{className:(0,i.cn)("group relative max-w-3xl m-auto w-full",t,{"max-w-3xl":o}),children:n})}e_.displayName="ChatTurnComponent"},46367:function(e,n,t){t.d(n,{i:function(){return h},n:function(){return u}});var a=t(52322),s=t(44460),i=t(23279),o=t(47843),r=t(90122),l=t(25706),c=t(98614),d=t(15584);function u(e){let{listIndex:n}=e,{t}=(0,c.$G)();return(0,a.jsxs)(i.zx,{variant:"ghost",className:"justify-between w-full rounded-spacing-s  hover:bg-surface-elevation-2",onPress:()=>{l.FG.value=n},children:[t("Chat.delete-messages")," ",(0,a.jsx)(r.XH,{height:"1.25em"})]})}function h(){let{t:e}=(0,c.$G)(),n=!!(0,d.BF)(l.FG);return(0,a.jsx)(o.Vq,{open:n,onOpenChange:e=>{e||(l.FG.value=null)},analyticsProps:{referrer:"ChatOptions",type:"DeleteMessagesDialog"},children:(0,a.jsxs)(o.cZ,{children:[(0,a.jsx)(o.fK,{children:(0,a.jsx)(o.$N,{children:e("Chat.delete-messages")})}),(0,a.jsx)(o.Be,{children:e("Chat.are-you-sure-you-want-to-delete-this-message")}),(0,a.jsxs)(o.cN,{children:[(0,a.jsx)(i.zx,{variant:"outline",onPress:()=>{l.FG.value=null},children:e("Common.cancel")}),(0,a.jsx)(i.zx,{onPress:()=>{l.B$.value=l.FG.value,l.FG.value=null,s.iN.messageDeleted({referrer:"DeleteMessagesDialog"})},color:"danger",children:e("Chat.delete-messages-action")})]})]})})}},40040:function(e,n,t){t.d(n,{K:function(){return u},q:function(){return d}});var a=t(52322),s=t(23279),i=t(47843),o=t(90122),r=t(25706),l=t(98614),c=t(15584);function d(e){let{listIndex:n}=e,{t}=(0,l.$G)();return(0,a.jsxs)(s.zx,{variant:"ghost",className:"justify-between w-full rounded-spacing-s  hover:bg-surface-elevation-2",onPress:()=>{r.HE.value=n},children:[t("Chat.rewind-conversation")," ",(0,a.jsx)(o.F_,{height:"1.25em"})]})}function u(){let{t:e}=(0,l.$G)(),n=!!(0,c.BF)(r.HE);return(0,a.jsx)(i.Vq,{open:n,onOpenChange:e=>{e||(r.HE.value=null)},analyticsProps:{referrer:"ChatOptions",type:"RewindMessagesDialog"},children:(0,a.jsxs)(i.cZ,{children:[(0,a.jsx)(i.fK,{children:(0,a.jsx)(i.$N,{children:e("Chat.rewind-conversation")})}),(0,a.jsx)(i.Be,{children:e("Chat.are-you-sure-you-want-to-rewind-the-conversation-to-this-point")}),(0,a.jsxs)(i.cN,{children:[(0,a.jsx)(s.zx,{variant:"outline",onPress:()=>{r.HE.value=null},children:e("Common.cancel")}),(0,a.jsx)(s.zx,{onPress:()=>{r.WK.value=r.HE.value,r.HE.value=null},color:"danger",children:e("Chat.rewind")})]})]})})}},74973:function(e,n,t){t.d(n,{j:function(){return G}});var a=t(52322),s=t(36562),i=t(44460),o=t(23279),r=t(25706),l=t(17063),c=t(19206),d=t(88724),u=t(2784);let h=e=>{let{name:n,enabled:t,className:s,buttonText:h,title:m,description:x,icon:f,handlePress:g}=e,[p,v]=(0,u.useState)(!1),_="".concat(c.hl.Keys.EducationCTAPrefix,"-").concat(n),b=e=>{v(e),r.iq.value=e};(0,u.useEffect)(()=>{if(!t||localStorage.getItem(_)){b(!1);return}localStorage.setItem(_,new Date().toISOString()),b(!0),i.iN.contentViewed({content:n,referrer:"EducationCTA"})},[_,t,n]);let y=()=>{b(!1),i.iN.elementDismissed({name:n,referrer:"EducationCTA"})};return p?(0,a.jsxs)("div",{className:(0,l.cn)("relative bg-background border rounded-spacing-l p-6 px-8 border-surface-elevation-3 max-w-80 flex flex-col items-center mt-4 mx-auto",s),children:[(0,a.jsx)("button",{"aria-label":"close",type:"button",className:"absolute top-1 right-1 text-2xl font-bold p-2 mt-1 text-icon-secondary hover:text-icon-primary",onClick:y,children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})}),f,(0,a.jsx)("p",{className:"text-4xl mb-2",children:m}),(0,a.jsx)("p",{className:"text-md-medium mb-2 text-muted-foreground",children:x}),!!h&&!!g&&(0,a.jsx)(o.zx,{variant:"primary",className:"mt-2",onPress:()=>{g(),y()},children:h})]}):null};var m=t(90122),x=t(98614);let f=()=>{let{t:e}=(0,x.$G)(),{enableVoice:n,isVoiceEnabled:t}=(0,s.AW)();return t?null:(0,a.jsx)(h,{name:"enable-voice",enabled:!0,buttonText:e("EducationCTA.Voice.button"),handlePress:n,title:e("EducationCTA.Voice.title"),description:e("EducationCTA.Voice.description"),icon:(0,a.jsx)(m.uA,{height:"48px",className:"text-voice-blue mb-3"})})};var g=t(10661),p=t(5654),v=t(65239),_=t(57352);function b(e){let{isLoading:n}=e,[t,s]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{let e;return n?s(!0):e=setTimeout(()=>s(!1),500),()=>clearTimeout(e)},[n]),(0,a.jsx)(v.M,{children:!!t&&(0,a.jsx)(_.E.div,{id:"load-more-spinner",initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},transition:{type:"spring",duration:.5},className:(0,l.cn)("absolute top-20 min-w-full h-[100px] left-0 p-unit-sm"),children:(0,a.jsx)(p.Z,{})},"load-more-spinner")})}function y(e){let{show:n,onPress:t}=e,{t:s}=(0,x.$G)();return(0,a.jsx)(v.M,{children:!!n&&(0,a.jsx)(_.E.div,{id:"scroll-to-bottom-button",initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",duration:.5},className:(0,l.cn)("absolute pointer-events-auto flex justify-end w-full bottom-0 left-0 p-unit-sm"),children:(0,a.jsx)(o.zx,{"aria-label":s("Chat.scroll-to-bottom"),size:"sm",isIconOnly:!0,onPress:t,children:(0,a.jsx)(m.ve,{})})})})}var j=t(74943),w=t(21051),k=t(46175),C=t(96362),N=t(94766),A=t(566),I=t(7649),P=t(77257),E=t(2236),F=t(15584);function S(){let{isStaff:e}=(0,A.a)(),{t:n}=(0,x.$G)(),{suggestedReplies:t,clearSuggestions:o,isReplyIdeaLoading:l}=(0,P.a)(),{isVoiceEnabled:c,expectCharacterSpeech:d,abortCharacterSpeech:u}=(0,s.AW)(),{characterId:h}=(0,I.AU)(),f=(0,F.BF)(r.LT),{publish:g}=(0,E.m)();if(!e)return null;if(l)return(0,a.jsx)("div",{className:"row gap-2 max-w-2xl pb-4 justify-center m-auto h-26 w-full ",children:(0,a.jsxs)(N.O,{className:"h-24 min-w-max p-2 ml-2 rounded-spacing-xs outline-2 outline-dashed outline-offset-2 outline-border-outline bg-brand-bg",children:[(0,a.jsx)(k.j,{autoInterval:2e3,className:"text-muted-foreground text-sm",phrases:["generating ideas","thinking...","almost there","a little longer","wow this is taking a while","way longer than it should","maybe something is wrong"]}),(0,a.jsx)(N.O,{className:"h-12 w-full p-2"})]})});let p=e=>{i.iN.elementClicked({referrer:"ReplyIdeaButton",action:"use_reply_idea"}),f&&u(),g(h,{type:"create_and_generate",message:e,ttsEnabled:c}),d(),o()};return(0,a.jsx)("div",{className:"row gap-2 max-w-2xl justify-center m-auto p-2",children:t.map(e=>(0,a.jsxs)(j.a2,{durationSeconds:.5,className:"outline-2 outline-dashed outline-offset-2 outline-border-outline p-2 bg-brand-bg rounded-spacing-xs text-sm",children:[(0,a.jsxs)("div",{className:"w-full flex justify-between mb-1",children:[(0,a.jsx)("div",{children:n("Chat.reply-idea-title")}),(0,a.jsx)(C.Z,{"aria-label":"Close suggestion",variant:"ghost",isIconOnly:!0,className:"h-auto px-0 w-2 -mr-3",onPress:()=>{i.iN.elementClicked({referrer:"ReplyIdeaButton",action:"clear_reply_idea"}),o()},children:(0,a.jsx)(m.Tw,{height:"1em",className:"opacity-50"})})]}),(0,a.jsx)(w.U,{children:e}),(0,a.jsx)("div",{className:"w-full flex justify-end",children:(0,a.jsx)(C.Z,{variant:"ghost",className:"bg-surface-elevation-3 h-auto px-2 py-1 mt-1",onPress:()=>p(e),children:n("Chat.try-this-reply")})})]},e))})}var O=t(65332),z=t(80147);function G(e){let{chatTurns:n,primaryCandidateMap:t,characterId:s,hasCustomBackground:i}=e,o=(0,u.useRef)(null),{getChatMessages:r,isRoom:c}=(0,E.m)(),[d,h]=(0,u.useState)(!1),[m,x]=(0,u.useState)(!0),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";o.current&&o.current.scrollTo({top:0,behavior:e})};O.M.useListen(()=>p("instant"));let v=(0,u.useCallback)(async()=>{!d&&m&&(h(!0),x(!!await r(s)),h(!1))},[s,d,m,r]),{isScrolling:_,isAtTop:j,isAtBottom:w,handleScroll:k}=(0,g.jR)("startAtBottom");return(0,u.useEffect)(()=>{j&&v()},[j,v]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{ref:o,id:"chat-messages",className:(0,l.cn)("overflow-x-hidden overflow-y-scroll px-1 flex flex-col-reverse min-w-full z-0",{"hide-scrollbar":!_}),onScroll:k,children:[!c&&(0,a.jsx)(f,{}),(0,a.jsx)(S,{}),n.map((e,o)=>(0,a.jsx)(z.x,{primaryCandidateIndex:t[e.turn_key.turn_id],isLastTurn:0===o,listItemIndex:n.length-o-1,turn:e,characterId:s,isRoom:c,hasCustomBackground:i},e.turn_key.turn_id))]}),(0,a.jsxs)("div",{className:"absolute w-full h-full overflow-hidden pointer-events-none",children:[(0,a.jsx)(y,{show:!w,onPress:()=>p()}),(0,a.jsx)(b,{isLoading:d})]})]})}}}]);